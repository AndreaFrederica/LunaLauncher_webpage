<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Luna Launcher</title>
    <meta name="color-scheme" content="light dark">
    <meta name="description" content="Luna Launcher：专注自由与整洁的 Minecraft 启动器。">
    <link rel="icon" type="image/png" href="resources/org.lunalauncher.LunaLauncher_256.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@100..900&family=Ubuntu+Mono:ital,wght@0,400;0,700;1,400;1,700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css">
</head>
<body>
    <div class="container">
        <div class="topbar">
            <a class="brand" href="#top">
                <img src="resources/org.prismlauncher.PrismLauncher.logo-darkmode.svg" alt="Luna Launcher">
            </a>
            <nav class="nav" aria-label="导航">
                <a href="#features" data-i18n="nav.features">特性</a>
                <a href="#get" data-i18n="nav.get">获取</a>
                <a href="build.html" data-i18n="nav.build">构建</a>
                <a href="#community" data-i18n="nav.community">参与</a>
                <a href="https://wiki.sirrus.cc" target="_blank" rel="noopener noreferrer">Wiki</a>
                <a href="https://blog.sirrus.cc" target="_blank" rel="noopener noreferrer">Blog</a>
            </nav>
            <div class="language-selector">
                <button type="button" id="language-button" class="language-button" aria-label="切换语言" title="Switch Language">
                    <svg class="language-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="10"></circle>
                        <line x1="2" y1="12" x2="22" y2="12"></line>
                        <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path>
                    </svg>
                    <span class="current-lang">简体中文</span>
                    <svg class="dropdown-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="6 9 12 15 18 9"></polyline>
                    </svg>
                </button>
                <div id="language-menu" class="language-menu">
                    <button type="button" class="language-option" data-lang="zh-CN">简体中文</button>
                    <button type="button" class="language-option" data-lang="en-US">English</button>
                </div>
            </div>
        </div>

        <header id="top" class="hero">
            <div class="hero-inner">
                <div>
                    <h1 data-i18n="hero.title">轻量、整洁、可定制的 Minecraft 启动器</h1>
                    <p data-i18n="hero.description">以实例隔离为核心,专注"用起来更省心":管理整包、更新资源、保持每个世界与配置互不干扰。</p>
                    <div class="cta-row">
                        <a class="btn primary" href="#get" data-i18n="hero.cta_get">获取与使用</a>
                        <a class="btn" href="https://github.com/AndreaFrederica/LunaLauncher/actions" target="_blank" rel="noopener noreferrer" data-i18n="hero.cta_actions">开发版本</a>
                        <a class="btn" href="https://github.com/AndreaFrederica/LunaLauncher/releases" target="_blank" rel="noopener noreferrer" data-i18n="hero.cta_releases">Releases</a>
                        <a class="btn" href="https://github.com/AndreaFrederica/LunaLauncher" target="_blank" rel="noopener noreferrer" data-i18n="hero.cta_github">GitHub</a>
                        <a class="btn" href="http://qm.qq.com/cgi-bin/qm/qr?_wv=1027&k=a9DqLmW9Gn672JapANmW_PGeyF1U3FAm&authKey=wMQbUiN9Sdi1uU4il7EOL5gXClz8QOtoAfQHKpCnMHUyxKr6xxy26qAQIxXufPkr&noverify=0&group_code=1084744325" target="_blank" rel="noopener noreferrer" data-i18n="hero.cta_qq">QQ 群</a>
                        <a class="btn" href="https://prismlauncher.org/" target="_blank" rel="noreferrer" data-i18n="hero.cta_prism">参考 Prism Launcher</a>
                    </div>
                    <div class="hero-badges" aria-label="标签">
                        <span class="badge" data-i18n="hero.badge_instance">实例隔离</span>
                        <span class="badge" data-i18n="hero.badge_modpack">整包管理</span>
                        <span class="badge" data-i18n="hero.badge_p2p">P2P 联机</span>
                        <span class="badge" data-i18n="hero.badge_fluent">Fluent 主题</span>
                    </div>
                    <div class="repo-stats" id="github-stats">
                        <a class="repo-stat loading" id="stat-version" href="https://github.com/AndreaFrederica/LunaLauncher/releases" target="_blank" rel="noopener noreferrer">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M12 2v4M12 18v4M4.93 4.93l2.83 2.83M16.24 16.24l2.83 2.83M2 12h4M18 12h4M4.93 19.07l2.83-2.83M16.24 7.76l2.83-2.83"/>
                            </svg>
                            <span class="stat-label" data-i18n="hero.stats_release">Release</span>
                            <span class="stat-value">Loading...</span>
                        </a>
                        <a class="repo-stat loading" id="stat-commit" href="https://github.com/AndreaFrederica/LunaLauncher/commits/develop" target="_blank" rel="noopener noreferrer">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="12" cy="12" r="4"/>
                                <line x1="1.05" y1="12" x2="7" y2="12"/>
                                <line x1="17.01" y1="12" x2="22.96" y2="12"/>
                            </svg>
                            <span class="stat-label" data-i18n="hero.stats_commit">Develop</span>
                            <span class="stat-value">Loading...</span>
                        </a>
                    </div>
                    <div class="notice" data-i18n="hero.notice">当前处于早期版本:可能需要自行构建,或联系开发者获取测试版本。</div>
                </div>
                <div class="hero-art">
                    <img src="resources/luna_home.png" alt="Luna Launcher 界面预览">
                </div>
            </div>
        </header>

        <main>
            <section id="features" class="section">
                <h2 data-i18n="features.title">特性</h2>
                <p class="lead" data-i18n="features.lead">参考 Prism Launcher 的使用体验,把常见的"安装、维护、切版本"流程做得更省心。</p>
                <div class="feature-blocks">
                    <div class="feature-row">
                        <div class="feature-text">
                            <h2 data-i18n="features.modpack_title">整包管理</h2>
                            <p data-i18n="features.modpack_desc">更轻松地安装与启动整包,同时保持实例目录整洁。减少手动安装、更新与排障的重复劳动。</p>
                        </div>
                    </div>
                    <div class="feature-row reverse">
                        <div class="feature-text">
                            <h2><span data-i18n="features.download_title">下载与镜像加速</span> <span class="badge" style="font-size: 11px; margin-left: 8px;" data-i18n="features.download_badge">开发中</span></h2>
                            <p data-i18n="features.download_desc">支持社区镜像 API(例如 BMCLAPI),让在国内网络环境下的下载更顺畅。BMCLAPI 支持仍在完善,部分场景可能不可用。</p>
                        </div>
                    </div>
                    <div class="feature-row">
                        <div class="feature-text">
                            <h2 data-i18n="features.instance_title">实例隔离</h2>
                            <p data-i18n="features.instance_desc">每个实例都有独立的 mods、资源包与设置。避免旧版本启动导致设置重置或误操作破坏世界。</p>
                        </div>
                    </div>
                    <div class="feature-row reverse">
                        <div class="feature-text">
                            <h2 data-i18n="features.p2p_title">P2P 联机</h2>
                            <p data-i18n-html="features.p2p_desc">内置支持 <a href="https://github.com/burningtnt/Terracotta" target="_blank" rel="noopener noreferrer">Terracotta</a> 和 <a href="https://github.com/ElicaseTech/YukariConnect" target="_blank" rel="noopener noreferrer">YukariConnect</a> P2P 联机功能。<span data-i18n="features.p2p_desc_more">无需端口映射或复杂的网络配置即可与朋友一起游戏。YukariConnect 旨在作为 AGPL 许可的 Terracotta 的替代实现。</span></p>
                        </div>
                    </div>
                    <div class="feature-row">
                        <div class="feature-text">
                            <h2 data-i18n="features.server_title">服务器预览</h2>
                            <p data-i18n="features.server_desc">从工具栏快速进入服务器预览，实时查看服务器状态和玩家信息，一键连接到常玩的服务器。</p>
                        </div>
                    </div>
                    <div class="feature-row reverse">
                        <div class="feature-text">
                            <h2><span data-i18n="features.server_mgmt_title">服务端管理</span> <span class="badge" style="font-size: 11px; margin-left: 8px;" data-i18n="features.server_mgmt_badge">开发中</span></h2>
                            <p data-i18n="features.server_mgmt_desc">让启动器也能启动服务端，方便与朋友进行多人游戏。适合小型服务器和临时联机场景。</p>
                        </div>
                    </div>
                    <div class="feature-row">
                        <div class="feature-text">
                            <h2 data-i18n="features.lunaui_title">LunaUI 自定义面板脚本</h2>
                            <p data-i18n-html="features.lunaui_desc">支持在实例目录 <code>lunaui/</code> 内编写 JS/JSON 自定义设置面板。可读取实例状态、切换模组启用状态，并提供类型定义（.d.ts）与开发文档。</p>
                        </div>
                    </div>
                </div>
            </section>

            <section id="get" class="section">
                <h2 data-i18n="get.title">获取与使用</h2>
                <p class="lead" data-i18n="get.lead">当前处于早期版本阶段:可能没有稳定安装包,面向开发者与早期测试者。</p>
                <div class="split">
                    <div class="panel">
                        <p data-i18n="get.panel_build">推荐方式:按照构建指南自行编译运行。也可以在 Releases 查看是否提供预览构建。</p>
                    </div>
                    <div class="panel">
                        <p data-i18n="get.panel_contact">如果你需要测试版本或遇到问题,欢迎通过 Issues 联系开发者。</p>
                    </div>
                </div>
                <div class="cta-row cta-row-margin">
                    <a class="btn primary" href="build.html" data-i18n="get.btn_build">构建指南</a>
                    <a class="btn" href="https://github.com/AndreaFrederica/LunaLauncher/blob/develop/docs/lunaui/README.md" target="_blank" rel="noopener noreferrer" data-i18n="get.btn_lunaui_docs">LunaUI 文档</a>
                    <a class="btn" href="https://github.com/AndreaFrederica/LunaLauncher/blob/develop/docs/lunaui/lunaui.d.ts" target="_blank" rel="noopener noreferrer" data-i18n="get.btn_lunaui_types">LunaUI 类型定义</a>
                    <a class="btn" href="https://github.com/AndreaFrederica/LunaLauncher/actions" target="_blank" rel="noopener noreferrer" data-i18n="get.btn_actions">GitHub Actions</a>
                    <a class="btn" href="https://github.com/AndreaFrederica/LunaLauncher/releases" target="_blank" rel="noopener noreferrer" data-i18n="get.btn_releases">Releases</a>
                    <a class="btn" href="https://github.com/AndreaFrederica/LunaLauncher/issues" target="_blank" rel="noopener noreferrer" data-i18n="get.btn_issues">联系开发者</a>
                </div>
                <div class="notice" data-i18n="get.notice">提示:镜像 API(含 BMCLAPI)支持仍在完善;如果你遇到下载异常,请优先反馈问题以便我们改进。</div>
            </section>

            <section id="community" class="section">
                <h2 data-i18n="community.title">参与</h2>
                <p class="lead" data-i18n="community.lead">我们会认真阅读每一条反馈,也欢迎一起参与开发。</p>
                <div class="grid">
                    <div class="card">
                        <h3 data-i18n="community.feedback_title">提交反馈</h3>
                        <p data-i18n="community.feedback_desc">把你遇到的问题、想要的功能、或界面建议提交到 GitHub Issues,并尽量附上日志与复现步骤。</p>
                    </div>
                    <div class="card">
                        <h3 data-i18n="community.qq_title">QQ 群</h3>
                        <p data-i18n="community.qq_desc">加入 QQ 群 (1084744325) 与其他用户交流,获取帮助或分享你的使用经验。</p>
                    </div>
                    <div class="card">
                        <h3 data-i18n="community.contribute_title">贡献代码与设计</h3>
                        <p data-i18n="community.contribute_desc">无论是改一个小 bug,还是提供新图标与界面稿,都很有价值。</p>
                    </div>
                </div>
            </section>

            <section class="section testimonials">
                <h2 data-i18n="testimonials.title">用户评价</h2>
                <div class="user-comment zh-only">
                    <img class="comment-avatar" src="https://api.dicebear.com/7.x/micah/svg?seed=LunaUser" alt="用户头像" loading="lazy">
                    <div class="comment-content">
                        <div class="comment-text">LunaLauncher 更适合中国宝宝的体质 :)</div>
                        <div class="comment-author">匿名用户</div>
                    </div>
                </div>
                <div class="user-comment en-only">
                    <img class="comment-avatar" src="https://api.dicebear.com/7.x/micah/svg?seed=LunaUserEN" alt="User avatar" loading="lazy">
                    <div class="comment-content">
                        <div class="comment-text">LunaLauncher - A Minecraft launcher tailored for Chinese players</div>
                        <div class="comment-author">Anonymous User</div>
                    </div>
                </div>
            </section>
        </main>

        <footer>
            <div class="footer-row">
                <div data-i18n="footer.copyright">© 2025-2026 Luna Launcher Project</div>
                <div class="footer-links">
                    <a href="https://github.com/AndreaFrederica/LunaLauncher" target="_blank" rel="noopener noreferrer" data-i18n="footer.github">GitHub</a>
                    <a href="https://github.com/AndreaFrederica/LunaLauncher/releases" target="_blank" rel="noopener noreferrer" data-i18n="footer.releases">Releases</a>
                    <a href="https://github.com/AndreaFrederica/LunaLauncher/issues" target="_blank" rel="noopener noreferrer" data-i18n="footer.issues">Issues</a>
                    <a href="http://qm.qq.com/cgi-bin/qm/qr?_wv=1027&k=a9DqLmW9Gn672JapANmW_PGeyF1U3FAm&authKey=wMQbUiN9Sdi1uU4il7EOL5gXClz8QOtoAfQHKpCnMHUyxKr6xxy26qAQIxXufPkr&noverify=0&group_code=1084744325" target="_blank" rel="noopener noreferrer" data-i18n="footer.qq">QQ 群</a>
                    <a href="https://wiki.sirrus.cc" target="_blank" rel="noopener noreferrer">Wiki</a>
                    <a href="https://blog.sirrus.cc" target="_blank" rel="noopener noreferrer">Blog</a>
                </div>
            </div>
            <div class="footer-disclaimer" data-i18n="footer.disclaimer">Luna Launcher 是一个独立的 Prism Launcher 分支项目,不隶属于、也不代表 Prism Launcher 项目。</div>
        </footer>
    </div>

    <script src="i18n.js"></script>

    <script>
    // GitHub stats fetcher - async to avoid blocking page load
    (function() {
        const REPO_OWNER = 'AndreaFrederica';
        const REPO_NAME = 'LunaLauncher';
        const DEFAULT_BRANCH = 'develop';

        // Cache key and duration
        const CACHE_KEY_VERSION = 'luna_github_version';
        const CACHE_KEY_COMMIT = 'luna_github_commit';
        const CACHE_KEY_COMMIT_SHA = 'luna_github_commit_sha';
        const CACHE_DURATION = 6 * 60 * 60 * 1000; // 6 hours

        // Format date to relative time (e.g., "2 days ago")
        function formatRelativeTime(dateStr) {
            const date = new Date(dateStr);
            const now = new Date();
            const diffMs = now - date;
            const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));
            const diffHours = Math.floor(diffMs / (1000 * 60 * 60));
            const diffMinutes = Math.floor(diffMs / (1000 * 60));

            const lang = document.body.getAttribute('data-lang') || 'zh-CN';

            if (diffDays > 0) {
                return lang === 'zh-CN'
                    ? `${diffDays} 天前`
                    : `${diffDays} day${diffDays > 1 ? 's' : ''} ago`;
            } else if (diffHours > 0) {
                return lang === 'zh-CN'
                    ? `${diffHours} 小时前`
                    : `${diffHours} hour${diffHours > 1 ? 's' : ''} ago`;
            } else if (diffMinutes > 0) {
                return lang === 'zh-CN'
                    ? `${diffMinutes} 分钟前`
                    : `${diffMinutes} minute${diffMinutes > 1 ? 's' : ''} ago`;
            } else {
                return lang === 'zh-CN' ? '刚刚' : 'just now';
            }
        }

        function updateVersionDisplay(version) {
            const statEl = document.getElementById('stat-version');
            const valueEl = statEl.querySelector('.stat-value');
            if (version) {
                valueEl.textContent = 'v' + version;
                statEl.classList.remove('loading');
            } else {
                valueEl.setAttribute('data-i18n-none', '');
                valueEl.textContent = window.i18n?.translations?.hero?.stats_none || 'None';
                statEl.classList.remove('loading');
                statEl.classList.add('empty');
            }
        }

        function updateCommitDisplay(dateStr, sha) {
            const statEl = document.getElementById('stat-commit');
            const valueEl = statEl.querySelector('.stat-value');
            if (dateStr) {
                valueEl._commitDate = dateStr;
                valueEl._commitSha = sha;
                // 显示简写 SHA + 相对时间
                const shortSha = sha ? sha.substring(0, 7) : '';
                const relativeTime = formatRelativeTime(dateStr);
                valueEl.innerHTML = `<span class="commit-sha" title="${sha}">${shortSha}</span> ${relativeTime}`;
                statEl.classList.remove('loading');
            } else {
                valueEl.setAttribute('data-i18n-none', '');
                valueEl.textContent = window.i18n?.translations?.hero?.stats_dev_version || 'Dev Build';
                statEl.classList.remove('loading');
                statEl.classList.add('empty');
            }
        }

        function showError(statEl) {
            const valueEl = statEl.querySelector('.stat-value');
            valueEl.textContent = '--';
            statEl.classList.remove('loading');
        }

        // Get cached data
        function getCached(key) {
            try {
                const cached = localStorage.getItem(key);
                if (cached) {
                    const data = JSON.parse(cached);
                    if (Date.now() - data.timestamp < CACHE_DURATION) {
                        return data.value;
                    }
                }
            } catch (e) {}
            return null;
        }

        // Set cached data
        function setCached(key, value) {
            try {
                localStorage.setItem(key, JSON.stringify({
                    value: value,
                    timestamp: Date.now()
                }));
            } catch (e) {}
        }

        // CORS proxy URLs
        const CORS_PROXIES = [
            'https://corsproxy.io/?',
            'https://api.allorigins.win/raw?url=',
            'https://api.codetabs.com/v1/proxy?quest='
        ];

        // Fetch latest release version with CORS proxy
        async function fetchLatestRelease() {
            const cachedVersion = getCached(CACHE_KEY_VERSION);
            if (cachedVersion !== null) {
                updateVersionDisplay(cachedVersion);
                return;
            }

            const apiUrl = `https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}/releases/latest`;

            // Try direct first
            try {
                const response = await fetch(apiUrl, { cache: 'no-store' });
                if (response.ok) {
                    const data = await response.json();
                    setCached(CACHE_KEY_VERSION, data.tag_name);
                    updateVersionDisplay(data.tag_name);
                    return;
                } else if (response.status === 404) {
                    updateVersionDisplay(null);
                    return;
                }
            } catch (e) {}

            // Try with CORS proxies
            for (const proxy of CORS_PROXIES) {
                try {
                    const response = await fetch(proxy + encodeURIComponent(apiUrl), { cache: 'no-store' });
                    if (response.ok) {
                        const data = await response.json();
                        setCached(CACHE_KEY_VERSION, data.tag_name);
                        updateVersionDisplay(data.tag_name);
                        return;
                    }
                } catch (e) {
                    continue;
                }
            }

            showError(document.getElementById('stat-version'));
        }

        // Fetch latest commit by parsing GitHub HTML page with CORS proxy
        async function fetchLatestCommit() {
            const pageUrl = `https://github.com/${REPO_OWNER}/${REPO_NAME}/commits/${DEFAULT_BRANCH}`;
            console.log('[GitHub] Fetching:', pageUrl);

            // GitHub HTML pages require CORS proxy, try directly with proxies
            for (const proxy of CORS_PROXIES) {
                try {
                    const fetchUrl = proxy + encodeURIComponent(pageUrl);
                    console.log('[GitHub] Trying proxy:', proxy);
                    const response = await fetch(fetchUrl, { cache: 'no-store' });
                    console.log('[GitHub] Response status:', response.status, response.ok);
                    if (response.ok) {
                        const html = await response.text();
                        console.log('[GitHub] HTML length:', html.length);
                        console.log('[GitHub] HTML preview (first 500):', html.substring(0, 500));

                        // Try various date patterns in GitHub HTML
                        const patterns = [
                            /<relative-time\s+datetime="([^"]+)"/,  // Modern format
                            /datetime="([^"]+)"/,                    // Any datetime attr
                            /"commit-tease[^"]*"[^>]*datetime="([^"]+)"/,
                            /data-date="([^"]+)"/,
                            /<time[^>]*datetime="([^"]+)"/i
                        ];

                        // NEW: Parse GitHub hydration JSON data (modern GitHub format)
                        // GitHub embeds commit data in <script type="application/json" data-target="react-app.hydration">
                        const hydrationMatch = html.match(/<script\s+type="application\/json"\s+data-target="react-app\.hydration"[^>]*>([\s\S]*?)<\/script>/);
                        console.log('[GitHub] Hydration match:', hydrationMatch);
                        if (hydrationMatch && hydrationMatch[1]) {
                            try {
                                // The JSON might be wrapped in a comment or have additional data
                                let jsonStr = hydrationMatch[1].trim();
                                // Handle potential comment wrapper
                                jsonStr = jsonStr.replace(/^\s*<!--[\s\S]*?-->/, '').trim();
                                const hydrationData = JSON.parse(jsonStr);
                                console.log('[GitHub] Hydration data keys:', Object.keys(hydrationData));

                                // Navigate the hydration data structure to find commits
                                // GitHub stores commits in data.payload.repository.branch.tabsCommits.nodes
                                if (hydrationData.payload?.repository?.branch?.tabsCommits?.nodes) {
                                    const commits = hydrationData.payload.repository.branch.tabsCommits.nodes;
                                    console.log('[GitHub] Commits found:', commits.length);
                                    if (commits.length > 0) {
                                        const firstCommit = commits[0];
                                        const dateStr = firstCommit.authoredDate || firstCommit.committedDate;
                                        const sha = firstCommit.oid;
                                        console.log('[GitHub] Latest commit date:', dateStr, 'SHA:', sha);
                                        if (dateStr) {
                                            setCached(CACHE_KEY_COMMIT, dateStr);
                                            setCached(CACHE_KEY_COMMIT_SHA, sha);
                                            updateCommitDisplay(dateStr, sha);
                                            return;
                                        }
                                    }
                                }
                                // Alternative path: data.payload.repository.commits.edges
                                if (hydrationData.payload?.repository?.commits?.edges) {
                                    const commits = hydrationData.payload.repository.commits.edges;
                                    if (commits.length > 0) {
                                        const firstCommit = commits[0].node;
                                        const dateStr = firstCommit.authoredDate || firstCommit.committedDate;
                                        const sha = firstCommit.oid;
                                        console.log('[GitHub] Latest commit date (edges):', dateStr, 'SHA:', sha);
                                        if (dateStr) {
                                            setCached(CACHE_KEY_COMMIT, dateStr);
                                            setCached(CACHE_KEY_COMMIT_SHA, sha);
                                            updateCommitDisplay(dateStr, sha);
                                            return;
                                        }
                                    }
                                }
                            } catch (e) {
                                console.warn('[GitHub] Hydration parse error:', e.message);
                            }
                        }

                        // Also check for JSON embedded data
                        const jsonMatch = html.match(/<script\s+type="application\/ld\+json"[^>]*>([^<]+)<\/script>/);
                        console.log('[GitHub] JSON-LD match:', jsonMatch);
                        if (jsonMatch && jsonMatch[1]) {
                            try {
                                const json = JSON.parse(jsonMatch[1]);
                                console.log('[GitHub] JSON-LD parsed:', json);
                                if (json.datePublished) {
                                    console.log('[GitHub] Found datePublished:', json.datePublished);
                                    setCached(CACHE_KEY_COMMIT, json.datePublished);
                                    updateCommitDisplay(json.datePublished);
                                    return;
                                }
                            } catch (e) {}
                        }

                        // Fallback: Look for direct commit JSON array pattern (GitHub may embed commit data inline)
                        // Pattern matches: "oid":"SHA","url":".../commit/SHA","authoredDate":"2026-01-04T..."
                        const directCommitMatch = html.match(/"oid":"([a-f0-9]+)","url":"[^"]*\/commit\/[a-f0-9]+","authoredDate":"(\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(?:\.\d+)?(?:Z|[+-]\d{2}:\d{2}))"/);
                        console.log('[GitHub] Direct commit match:', directCommitMatch);
                        if (directCommitMatch && directCommitMatch[2]) {
                            const sha = directCommitMatch[1];
                            const dateStr = directCommitMatch[2];
                            console.log('[GitHub] Found direct commit date:', dateStr, 'SHA:', sha);
                            setCached(CACHE_KEY_COMMIT, dateStr);
                            setCached(CACHE_KEY_COMMIT_SHA, sha);
                            updateCommitDisplay(dateStr, sha);
                            return;
                        }

                        for (let i = 0; i < patterns.length; i++) {
                            const match = html.match(patterns[i]);
                            console.log('[GitHub] Pattern', i, 'match:', match);
                            if (match && match[1]) {
                                const dateStr = match[1];
                                console.log('[GitHub] Found date:', dateStr);
                                setCached(CACHE_KEY_COMMIT, dateStr);
                                updateCommitDisplay(dateStr, null);
                                return;
                            }
                        }

                        // Final fallback: search for ISO date pattern anywhere
                        const isoDateMatch = html.match(/\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}Z/);
                        console.log('[GitHub] ISO date fallback match:', isoDateMatch);
                        if (isoDateMatch) {
                            const dateStr = isoDateMatch[0];
                            console.log('[GitHub] Found ISO date:', dateStr);
                            setCached(CACHE_KEY_COMMIT, dateStr);
                            updateCommitDisplay(dateStr, null);
                            return;
                        }
                    }
                } catch (e) {
                    console.warn('[GitHub] Proxy failed:', proxy, e.message);
                    continue;
                }
            }

            console.log('[GitHub] All proxies failed');
            showError(document.getElementById('stat-commit'));
        }

        // Initialize after DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', function() {
                setTimeout(fetchLatestRelease, 100);
                setTimeout(fetchLatestCommit, 100);
            });
        } else {
            setTimeout(fetchLatestRelease, 100);
            setTimeout(fetchLatestCommit, 100);
        }
    })();
    </script>

    <script src="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/js/glightbox.min.js"></script>
    <script>
        // Initialize GLightbox for image preview
        document.addEventListener('DOMContentLoaded', function() {
            const lightbox = GLightbox({
                selector: 'img[alt]:not(.brand img, .comment-avatar), a[href$=".png"], a[href$=".jpg"], a[href$=".jpeg"], a[href$=".gif"], a[href$=".webp"]',
                touchNavigation: true,
                loop: true,
                zoomable: true,
                draggable: true,
                openEffect: 'zoom',
                closeEffect: 'zoom',
                slideEffect: 'slide'
            });
        });
    </script>
</body>
</html>
